<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rutas de Mapas</title>
  <link rel="stylesheet" href="./style/estilos.css">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>

<body>
  <div class="container">
    <h1>Buscar Ruta</h1>
    <label for="origenMapa">Mapa de Origen:</label>
    <input id="origenMapa" type="text">

    <label for="origenZona">Zona de Origen:</label>
    <select id="origenZona">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>

    <label for="destinoMapa">Mapa de Destino:</label>
    <input id="destinoMapa" type="text">

    <label for="destinoZona">Zona de Destino:</label>
    <select id="destinoZona">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>

    <button class="btn btn-success" onclick="buscarRuta()">Buscar Ruta</button>

    <div class="output" id="output"></div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  
  <script type="module">
    import alcyone from './alcyone/alcyoneAdd.js';
    import atlasA from './atlasA/atlasAAdd.js';
    import atlasB from './atlasB/atlasBAdd.js';
    import atlasC from './atlasC/atlasCAdd.js';
    import aquila from './aquila/aquilaAdd.js';
    import auriga from './auriga/aurigaAdd.js';
    import bootes from './bootes/bootesAdd.js';
    import cygni from './cygni/cygniAdd.js';
    import eridani from './eridani/eridaniAdd.js';
    import helvetios from './helvetios/helvetiosAdd.js';
    import maia from './maia/maiaAdd.js';
    import orion from './orion/orionAdd.js';
    import persei from './persei/perseiAdd.js';
    import sadatoni from './sadatoni/sadatoniAdd.js';
    import sirius from './sirius/siriusAdd.js';
    import volantis from './volantis/volantisAdd.js';
    todosLosMapas.push(alcyone);
    todosLosMapas.push(atlasA);
    todosLosMapas.push(atlasB);
    todosLosMapas.push(atlasC);
    todosLosMapas.push(aquila);// REVISE HASTA AQUI
    todosLosMapas.push(auriga);
    todosLosMapas.push(bootes);
    todosLosMapas.push(cygni);
    todosLosMapas.push(eridani);
    todosLosMapas.push(helvetios);
    todosLosMapas.push(maia);
    todosLosMapas.push(orion);
    todosLosMapas.push(persei);
    todosLosMapas.push(sadatoni);
    todosLosMapas.push(sirius);
    todosLosMapas.push(volantis);
    console.log(todosLosMapas);
  </script>
  <script>
    const mapas = ["alcyone", "atlas a", "atlas b", "atlas c", "aquila", "auriga", "bootes", "cygni", "eridani",
      "helvetios", "maia", "orion", "persei", "sadatoni", "sirius", "volantis"
    ];
    const todosLosMapas = []; // Aquí se agregarán todos los mapas como en Java

    // Clase Paso
    class Paso {
      constructor(nombreMapa, numeroZona, numeroPortal) {
        this.nombreMapa = nombreMapa;
        this.numeroZona = numeroZona;
        this.numeroPortal = numeroPortal;
      }
    }

    // Clase Nodo
    class Nodo {
      constructor(mapa, zona, aparecerPortal, pasos) {
        this.mapa = mapa;
        this.zona = zona;
        this.aparecerPortal = aparecerPortal;
        this.pasos = pasos;
      }
    }

    // Clase RutaFinder
    class RutaFinder {
      constructor(todosLosMapas) {
        this.todosLosMapas = todosLosMapas;
      }

      encontrarRutaConPasos(mapaOrigen, zonaOrigen, mapaDestino, zonaDestino) {
        const visitados = new Set();
        const rutasEncontradas = [];
        const queue = [];
        queue.push(new Nodo(mapaOrigen, zonaOrigen, -1, new Set()));

        while (queue.length > 0) {
          const actual = queue.shift();
          const mapaActual = actual.mapa;
          const zonaActual = actual.zona;
          const pasosActuales = actual.pasos;

          // Marcar la visita actual
          const claveVisita = `${mapaActual}-${zonaActual}`;
          if (visitados.has(claveVisita)) {
            continue;
          }
          visitados.add(claveVisita);

          // Agregar el paso actual a la ruta
          if (!(mapaActual === mapaOrigen && zonaActual === zonaOrigen)) {
            pasosActuales.add(new Paso(mapaActual, zonaActual, actual.aparecerPortal));
          }

          // Verificar si hemos llegado al destino
          if (mapaActual.toLowerCase() === mapaDestino.toLowerCase() && zonaActual === zonaDestino) {
            rutasEncontradas.push(new Set([...pasosActuales]));
            continue;
          }

          // Obtener los portales de la zona actual
          const mapa = this.obtenerMapaPorNombre(mapaActual);
          if (mapa) {
            for (const zona of mapa.listZona) {
              if (zona.numeroZona === zonaActual) {
                const portales = zona.listPortales;
                if (portales) {
                  for (const portal of portales) {
                    if (portal && portal.namePortal) {
                      const nuevoNodo = new Nodo(portal.namePortal, portal.irZona, portal.numeroPortal, new Set([...
                        pasosActuales
                      ]));
                      queue.push(nuevoNodo);
                    }
                  }
                }
              }
            }
          }
        }

        return rutasEncontradas;
      }

      obtenerMapaPorNombre(nombreMapa) {
        return this.todosLosMapas.find(mapa => mapa.nombreMapa.toLowerCase() === nombreMapa.toLowerCase());
      }
    }

    // Función para inicializar el autocomplete
    $(function () {
      $("#origenMapa, #destinoMapa").autocomplete({
        source: mapas
      });
    });

    // Función para buscar la ruta
    function buscarRuta() {
      console.error(todosLosMapas)
      const origenMapa = document.getElementById("origenMapa").value.toLowerCase();
      const origenZona = parseInt(document.getElementById("origenZona").value);
      const destinoMapa = document.getElementById("destinoMapa").value.toLowerCase();
      const destinoZona = parseInt(document.getElementById("destinoZona").value);

      const rutaFinder = new RutaFinder(todosLosMapas);
      const rutas = rutaFinder.encontrarRutaConPasos(origenMapa, origenZona, destinoMapa, destinoZona);
      mostrarRutas(rutas, origenMapa, origenZona);
    }

    // Función para mostrar las rutas encontradas
    function mostrarRutas(rutas, origenMapa, origenZona) {
      const output = document.getElementById("output");
      output.innerHTML = "";

      if (rutas.length === 0) {
        output.innerHTML = "No se encontró ninguna ruta.";
        return;
      }

      let rutaNum = 1;
      rutas.forEach(ruta => {
        const rutaDiv = document.createElement("div");
        rutaDiv.classList.add("ruta");
        rutaDiv.innerHTML =
          `<strong>Ruta ${rutaNum} encontrada:</br>Origen ${origenMapa} zona ${origenZona}</strong>`;
        ruta.forEach(paso => {
          const pasoDiv = document.createElement("div");
          pasoDiv.innerHTML =
            `<span class="portal">Portal: ${paso.numeroPortal}</span>, Mapa: ${paso.nombreMapa}, Zona: ${paso.numeroZona}`;
          pasoDiv.classList.add("paso"); // Añadir clase para estilos
          rutaDiv.appendChild(pasoDiv);

          // Añadir evento de clic a cada portal
          const portalSpan = pasoDiv.querySelector(".portal");
          portalSpan.addEventListener('click', () => {
            portalSpan.classList.toggle('seleccionado');
          });
        });
        output.appendChild(rutaDiv);
        rutaNum++;
      });


    }
  </script>
</body>

</html>